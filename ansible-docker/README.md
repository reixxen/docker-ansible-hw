# Ansible Role: Установка Docker

Этот Ansible плейбук устанавливает Docker на целевые хосты с операционной системой Ubuntu.

## Описание

Плейбук выполняет полную установку Docker Engine, включая:

1. Установку необходимых зависимостей
2. Добавление официального репозитория Docker

3. Установку Docker CE и сопутствующих компонентов

4. Настройку сервиса Docker

5. Добавление текущего пользователя в группу docker

6. Перезагрузку системы для применения изменений

## Требования

- Целевые хосты должны работать на Ubuntu

- Ansible 2.9+

- Привилегии sudo на целевых хостах

## Переменные

Плейбук не требует дополнительных переменных, но использует следующие факты Ansible:

**ansible_distribution_release** - для определения кодового имени дистрибутива

**ansible_user** - для определения текущего пользователя

## Использование

1. Создайте inventory файл с целевыми хостами:
[demo]
server1 ansible_host=192.168.1.100
server2 ansible_host=192.168.1.101

2. Запустите плейбук:
ansible-playbook -i inventory playbook.yml

Или для конкретной группы хостов:
ansible-playbook -i inventory playbook.yml --limit demo

## Структура плейбука

Плейбук состоит из следующих задач:

### Основные задачи:

1. Зависимости - установка необходимых пакетов (ca-certificates, curl)

2. Ключи - добавление GPG ключа Docker

3. Репозиторий - настройка стабильного репозитория Docker

4. Установка Docker - установка основных компонентов Docker

5. Сервис Docker - запуск и включение в автозагрузку сервиса Docker

### Постустановочные задачи (только для Ubuntu):

1. Создание группы docker

2. Добавление пользователя в группу docker

3. Перезагрузка системы

Установленные компоненты

- **docker-ce** - Docker Community Edition

- **docker-ce-cli** - Docker CLI

- **containerd.io** - контейнерная среда выполнения

- **docker-buildx-plugin** - plugin для расширенной сборки образов

- **docker-compose-plugin** - plugin для Docker Compose

## Примечания

- После выполнения плейбука требуется перезагрузка системы для применения изменений групп пользователей

- Текущий пользователь Ansible будет добавлен в группу docker, что позволит работать с Docker без sudo

- Плейбук обновляет кеш пакетов и использует 24-часовой кеш для оптимизации

- Используется официальный репозиторий Docker для обеспечения актуальности версий

## Проверка установки

После выполнения плейбука и перезагрузки, проверьте установку:

```bash
docker --version
docker ps
```
